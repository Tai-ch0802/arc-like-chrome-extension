# 開發摘要 - 2026-01-26

## 變更項目
- [modules/utils/textUtils.js]: **[NEW]** 建立 HTML 轉義工具函式 `escapeHtml` 以防止 XSS。
- [modules/searchManager.js]: 重寫 `highlightText` 函式，採用「先轉義、再標記」的安全演算法，修復搜尋高亮的 XSS 漏洞。
- [modules/modalManager.js]: 
    - 對所有動態插入的內容（標題、預設值等）進行 HTML 轉義。
    - 移除重複的 `GROUP_COLORS` 定義，統一從 `groupColors.js` 匯入。
- [modules/ui/bookmarkRenderer.js]:
    - **[Refactor]** 全面改用 Event Delegation 模式，在 `#bookmark-list` 層級統一處理事件。
    - 移除重複的 `GROUP_COLORS` 定義，改由 `groupColors.js` 匯入。
    - 為書籤項目 (`bookmark-item`) 添加 `role="button"` 以符合無障礙規範。
- [GEMINI.md]: 更新 `key_files` 加入 `textUtils.js` 的描述。
- [sidepanel.css]: 為 `#tab-list`, `#bookmark-list`, `#other-windows-list` 添加 `content-visibility: auto`。
- [sidepanel.html]: 為 `Sortable.min.js` 添加 `defer` 屬性。
- [modules/apiManager.js]: 新增 `getSubTree` 方法。
- [usecase_tests/*]: 更新 Puppeteer 測試以相容 `content-visibility` 優化。

## 技術決策
- **安全第一**：採用 single-scan 與區間合併的演算法來處理搜尋高亮，確保在插入 `<mark>` 標籤前，原始文字已完成轉義，避免巢狀或惡意 HTML 注入。
- **DRY 原則**：將散落在三處的 `GROUP_COLORS` 統一至 `modules/ui/groupColors.js`，減少未來維護顏色時出錯的機率。
- **前端效能優化**: 
    - 啟用 `content-visibility: auto` 讓瀏覽器延遲渲染視口外的長列表內容，提升初始化速度。
    - **Event Delegation**: 將書籤列表的點擊與鍵盤事件委派至容器層級，減少大量監聽器開銷，並實作 Lazy Rendering 機制。
- **測試調整**: 由於 `content-visibility` 會導致視口外元素不渲染（尺寸可能為 placeholder 大小），Puppeteer 需要顯式執行 `scrollIntoView` 才能正確操作元素。

## 待辦事項
- [x] 修復 XSS 安全漏洞
- [x] 清理程式碼重複
- [x] 提升無障礙性
- [x] 重構 `bookmarkRenderer.js` 為 Event Delegation 模式
