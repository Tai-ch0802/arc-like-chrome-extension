# 開發摘要 - 2026-02-24

## 變更項目
- `modules/aiManager.js`: 新增。負責與本機 Gemini Nano (`globalThis.LanguageModel` API) 的互動、模型可用性檢查、Prompt 封裝與 JSON 解析。
- `modules/ui/aiGrouperUI.js`: 新增。負責「✨ 智慧整理」按鈕邏輯、讀取未分類分頁、呼叫 AI、執行群組化與 Toast UI (復原按鈕) 處理。
- `modules/stateManager.js`: 新增 `lastAutoGroupState` 狀態與存取方法，以支援復原 (Undo) 功能。
- `modules/apiManager.js`: 在 `addTabToNewGroup` 中加入 `windowId` 參數，避免跨視窗分頁群組化錯誤，並統一 `ungroupTabs` 供復原使用。
- `sidepanel.js`: 將 `ui.initAiGrouper()` 整合進側邊欄初始化流程中。
- `sidepanel.html`: 加入「✨ 智慧整理」按鈕與 Toast Notification UI，並全面賦予 `data-i18n` 屬性。
- `sidepanel.css`: 加入 Smart Auto-Grouping 相關的樣式，包含 `.loading` 狀態設定與 Toast 推播動畫。
- `_locales/*/messages.json`: 批次寫入 14 國語言的翻譯字串，提供 AI 整理功能的跨語系國際化支援。
- `/docs/specs/feature/BASE-009_smart-auto-grouping/`: 建立本次功能的 PRD (產品需求) 與 SA (系統分析) 文件，落實 Spec-First 的 SDD (Spec-Driven Development) 架構。

## 技術決策
- **隔離防護 (Facade 封裝)**: 不去干涉核心的 `tabRenderer.js`，而是建立獨立的 `aiGrouperUI.js` 控制 AI 相關行為，將改動風險降至最低。
- **本地 AI Model (Gemini Nano) 對接**: 為符合最新版 Chrome 架構，使用全域的 `LanguageModel.create()` 與 `availability()` API 代替已棄用的 `window.ai` 寫法，並加上 `expectedOutputLanguage: 'en'`, `temperature: 0.1`, `topK: 1` 消除控制台 warning、大幅提高執行速度並防範模型過度腦補。
- **復原 (Undo) 狀態暫存**: 在 `stateManager` 中儲存上一次操作返回的 `tabId` 陣列，10 秒 Timeout 給予反悔空間，成功防止誤操作。
- **國際化 (i18n)**: 實施全語系支援，包含前端 HTML 的 `data-i18n` 標記寫入，以及 JavaScript 中透過 `api.getMessage` 渲染動態 Toast。

## 待辦事項
- [ ] 持續觀察使用者實際操作上是否有遇到 Token 溢出問題（當前暫定以過濾最多前 30 個 Tabs 且截斷 URL 做防護），視情況考慮採用更進階或漸進式的 Prompt。
- [ ] 未來若 WebAI API 持續擴充，可考慮加入「語意分頁搜尋」或「分頁摘要」以進一步豐富 AI 功能。
