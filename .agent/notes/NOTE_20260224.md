# 開發摘要 - 2026-02-24

## 變更項目
- `.agent/rules/RULE_005_DEVELOPMENT_GUIDELINES.md`：新增設定下拉選單 (`modal-select`) 的設計準則。
- `_locales/*/messages.json`：批次增加 `languageSectionHeader` 及 `languageAuto` 支援 14 種語言以配合語言切換下拉選單。
- `modules/aiManager.js`：
  - 更新 Prompt API 呼叫的參數，依據最新官方文件改用 `expectedInputs` 和 `expectedOutputs` 陣列格式。
  - 修改 Prompt 內容，強制 Gemini 遵守 `currentLang` 指示，輸出對應語系的標籤。
- `modules/apiManager.js`：實裝 Custom i18n Loader，攔截原生的 `chrome.i18n.getMessage` 實作非同步語言載入與變數替換 `$1` 的功能，並提供 `getResolvedUILanguage()` 取得當下套用的語系。
- `modules/stateManager.js`：加入 `uiLanguage` 變數來管理使用者手動切換的介面語言設定。
- `modules/ui/themeManager.js`：在設定面板加入語言下拉選單，並在切換時觸發 `window.location.reload()` 立即套用配置。
- `sidepanel.js`：調整啟動順序，在畫面初始渲染（含靜態文字替換）前，先呼叫 `await api.loadCustomI18n()`。
- `sidepanel.css`：
  - 調整 `#toast-container` 寬度（`width: 90%`, `max-width: 380px`），避免 AI 群組化提示文字過度擁擠。
  - 調整 `.settings-button` 及 `.modal-button` 樣式，移除 `white-space: nowrap` 並改用 `min-height` 與 `flex` 排版，解決多語系（如自訂主題選項）文案過長導致超出按鈕範圍的問題。

## 技術決策
- **Custom i18n Loader**：原生地 `chrome.i18n` 只能跟隨作業系統/瀏覽器的啟動語系，無法在執行時動態變更。為了解決手動切換語系與確保 AI 模型接收正確語境的需求，必須拉出一層攔截器覆蓋原有封裝。
- **重載套用**：由於側邊欄是 HTML 介面，使用 `window.location.reload()` 是套用全新 UI 語言最乾淨、徹底的方式，避免動態更新的遺漏。
- **LanguageModel API 更新**：為了消除 `No output language was specified` 警告並符合最新的 Prompt API 規範，採用文件最新的陣列賦值 `expectedInputs: [{ type: "text", languages: ["en", currentLang] }]` 設定法。

## 待辦事項
- [ ] 觀察 Prompt API 宣告 output 陣列參數後，後續 Chrome Beta 更新狀況是否完全解決 Warning。
