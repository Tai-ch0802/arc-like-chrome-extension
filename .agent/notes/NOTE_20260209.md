# 開發摘要 - 2026-02-09

## 變更項目
- `usecase_tests/puppeteer_tests/add_to_group.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/bookmark_folder_toggle.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/edit_bookmark.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/open_bookmark.test.js`: 重構為共用頁面模式，加入 cleanupExtraTabs 保留 chrome-extension:// 分頁
- `usecase_tests/puppeteer_tests/other_windows.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/search_edge_cases.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/tab_group_toggle.test.js`: 重構為共用頁面模式
- `usecase_tests/puppeteer_tests/tab_switch.test.js`: 重構為共用頁面模式，加入 afterEach 清理分頁並重新導航
- `usecase_tests/puppeteer_tests/theme_edge_cases.test.js`: 重構為共用頁面模式，加入 modal-overlay 關閉邏輯
- `usecase_tests/puppeteer_tests/theme_switch.test.js`: 重構為共用頁面模式，加入 modal-overlay 關閉邏輯

## 技術決策

### 共用頁面模式 (Shared Page Pattern)
- 將所有測試從「每次測試建立新頁面 (`browser.newPage()`)」改為在 `beforeAll` 初始化一次共用頁面
- 這大幅減少了 CI 環境中的開銷與逾時問題

### 關鍵修復
1. **Settings 面板是 Modal 對話框**：設定切換按鈕開啟的是 `modal-overlay` 而非內嵌面板，需要透過點擊 overlay 背景來關閉
2. **分頁清理需保留擴充功能頁面**：`cleanupExtraTabs` 不能用 `tabs.slice(1)` 因為可能刪除 Puppeteer 控制的頁面，改為只刪除非 `chrome-extension://` 的分頁
3. **執行環境銷毀**：切換分頁或刪除分頁可能導致 sidepanel 頁面的執行環境被銷毀，需用 `page.goto(sidePanelUrl)` 重新導航

## 待辦事項
- [x] 所有 10 個測試檔案重構完成
- [x] 本地全套測試通過 (30 passed, 2 skipped)
- [ ] 觀察 CI 執行結果確認穩定性
