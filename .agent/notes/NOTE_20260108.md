# 開發摘要 - 2026-01-08

## 變更項目
- **[modules/stateManager.js]**:
    - 新增 `removeWindowName` 與 `pruneWindowNames` 函式，用於清理已關閉視窗的命名資料。
    - 啟動時 (`initWindowNames`) 自動呼叫 `pruneWindowNames` 同布清理無效資料。
- **[sidepanel.js]**:
    - 新增 `chrome.windows.onRemoved` 監聽器，視窗關閉時即時移除命名資料。
    - 初始化時呼叫 `pruneWindowNames`。
- **[modules/icons.js]**:
    - [NEW] 建立圖示模組，集中管理 `EDIT_ICON_SVG`，落實 DRY 原則。
- **[modules/ui/bookmarkRenderer.js]**:
    - 改為引用 `modules/icons.js` 中的 `EDIT_ICON_SVG`，移除重複的 SVG 字串。
- **[modules/ui/tabRenderer.js]**:
    - 重構 `renderOtherWindowsSection`，將所有 class 從 `bookmark-*` 遷移至專屬的 `window-*` (`window-folder`, `window-icon`, `window-title`, `window-edit-btn`)，實現樣式與語意的完全分離。
    - 改為引用 `modules/icons.js` 中的 `EDIT_ICON_SVG`。
- **[sidepanel.css]**:
    - 新增 `window-*` 系列的樣式定義，從 `bookmark-*` 獨立出來。
    - 新增 `.window-folder:hover .window-edit-btn` 讓編輯按鈕僅在懸停時顯示，並設定 Hover 顏色為 `warning-color` (黃色)。
- **[_locales/*/messages.json]**:
    - 為所有 14 個語系檔補上 `renameWindow`, `renameWindowDialogTitle`, `enterWindowName` 等視窗命名相關的翻譯鍵值。
- **[.agent/rules/RULE_005_DEVELOPMENT_GUIDELINES.md]**:
    - 新增開發規範：禁止重複 Icon 定義 (DRY)、UI 互動元素應預設使用 Hover 顯示。
- **[usecase_tests/puppeteer_tests/rename_window.test.js]**:
    - 更新測試邏輯以適應新的 class name (`.window-folder`)。
    - 新增 `page.hover()` 步驟以處理預設隱藏的編輯按鈕。
    - 新增測試案例：驗證關閉視窗後 Storage 資料是否正確清除。
- **[usecase_tests/puppeteer_tests/other_windows.test.js]**:
    - 更新測試選擇器以適應新的 class name。

## 技術決策
- **Storage 清理策略**: 採取「即時清理 (Runtime)」配合「啟動時同步 (Startup Pruning)」的雙重機制，確保 `windowNames` 對應表不會因視窗關閉或瀏覽器崩潰而殘留垃圾資料 (Stale Data)。
- **樣式分離 (Decoupling)**: 儘管視窗列表與書籤列表外觀相似，但為了語意清晰與後續維護 (避免改 A 壞 B)，決定將兩者的 CSS class 完全拆分 (`window-*` vs `bookmark-*`)。
- **Icon 集中管理**: 鑑於 `.svg` 字串在程式碼中重複出現造成維護困難，建立 `icons.js` 統一管理。

## 待辦事項
- [ ] 觀察其他語系的翻譯是否準確 (目前部分語系僅補上 Key 或由英文暫代)。
